_subdirectory: template

# Post-copy commands:
_tasks:
  # Only run these commands when copying the template
  - command: "git init -b main"
    when: "{{ _copier_operation == 'copy'}}"

# Message to show after generating or regenerating the project successfully
_message_after_copy: |

  Your project "{{ website_abbrev }}" has been created successfully!

  Next steps:

  1. Change directory to the project root:

    $ cd {{ _copier_conf.dst_path }}

  2. Install the pre-commit hooks and add (called "update" here) the Quarto extension:

    $ just install-precommit
    $ just update-quarto-theme

  3. Install [`spaid`](https://github.com/seedcase-project/spaid) and run these setup steps:

    $ spaid_gh_create_repo_from_local -h
    $ spaid_gh_set_repo_settings -h
    $ spaid_gh_ruleset_basic_protect_main -h

  4. Configure GitHub following this
    [guide](https://guidebook.seedcase-project.org/operations/security#using-github-apps-to-generate-tokens):

    - Install the [auto-release-token](https://github.com/apps/auto-release-token) GitHub App
    - Create an `UPDATE_VERSION_TOKEN` secret for the GitHub App
    - Create an `UPDATE_VERSION_APP_ID` variable of the GitHub App's ID

  5. List and complete all TODO items in the repository:

    $ just list-todos

# Questions:
seedcase_website:
  type: bool
  default: false
  help: "Is this website part of the Seedcase Project? If not, the theme will not be applied."

author_given_name:
  type: str
  help: "What is your first/given name?"

author_family_name:
  type: str
  help: "What is your last/family name?"

website_abbrev:
  type: str
  help: "What is the abbreviated name of the website? This could be the name of your GitHub repository and should be a short, lowercase name without spaces or special characters. For example, 'new-website'."
  default: "{{ _copier_conf.dst_path | basename }}"

website_github_repo:
  type: str
  help: "What is or will be the GitHub repository spec for the website?"
  placeholder: "user/repo"
  validator: |
    {% if website_github_repo and not (website_github_repo | regex_search('^[\w.-]+\/[\w.-]+$')) %}
    Must be in the format `user/repo` and contain only alphanumeric characters and `_`, `-`, or `.`.
    {% endif %}

hosting_provider:
  type: str
  help: "What hosting provider will you use for the website?"
  choices:
    - netlify
    - gh-pages

# Configurations not asked
github_org:
  type: str
  default: "{{ website_github_repo.split('/')[0] if website_github_repo else '' }}"
  when: false

github_repo:
  type: str
  default: "{{ website_github_repo.split('/')[1] if website_github_repo else '' }}"
  when: false
